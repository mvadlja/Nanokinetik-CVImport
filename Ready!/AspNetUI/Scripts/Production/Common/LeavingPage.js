$(function () { initializePreventableClose() }); var firstSubmit = true; var lastClickedIsCancel = true; function refreshFirstSubmit() { firstSubmit = true } function initializePreventableClose() { setTimeout("$('#inFormPostBack').val('false')", 100); setTimeout("$('#skipPrevent').val('false')", 100); var visibleForms = $(".preventableClose:visible"); if (visibleForms.length > 0) { $("#hasChanges").val("true"); $(".preventableClose").click(function (e) { if (e.target.toString().indexOf("javascript:") > -1 || (e.target.href != null && (e.target.target != "_blank" || e.target.href.indexOf("javascript") > -1)) || (e.target.nodeName.toLowerCase().indexOf("input") > -1 && (e.target.type.toLowerCase().indexOf("button") > -1 || e.target.id.toLowerCase().indexOf("save") > -1))) { $("#inFormPostBack").val("true") } }); $(document).click(function (event) { lastClickedIsCancel = $(event.target).hasClass("cancel") || $(event.target).hasClass("Cancel"); firstSubmit = true }) } else { $("#hasChanges").val("false") } $(".Save").click(function () { $("#skipPrevent").val("true") }); $(window).bind("beforeunload", function () { var changed = $("#hasChanges").val(); var skipPrevent = $("#skipPrevent").val(); var inFormPostBack = $("#inFormPostBack").val(); if (changed == "true") { if (inFormPostBack == "false") { if (skipPrevent == "false") { if (firstSubmit) { firstSubmit = false; return "This page may contain unsaved data." } } else { $("#skipPrevent").val("true") } } else { } } }) }